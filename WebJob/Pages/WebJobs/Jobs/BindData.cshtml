@using Web.Application.Features.Finances.Jobs.DTOs
@using Web.Application.Interfaces

@inject ICurrentUserService currentUserService;

@model Tuple<PaginatedResult<JobGetByPageDto>, PagingInput>
@{
    Layout = null;
    var roles = await currentUserService.GetRoles();
    bool isFullRole = currentUserService.IsSuperAdminRole(roles);
}
<table id="sticky-table" class="main-table table table-striped table-hover mb-0">
    <thead class="text-black">
        <tr>
            <th class="pt-1 pb-1" colspan="4">
                <div class="row flex-between-center">
                    <div class="col-auto col-sm-auto d-flex align-items-center pe-0">
                        <h6 class="mb-0 text-nowrap total-rows fw-semi-bold">
                            Tìm thấy <span class="text-danger">@(Model.Item1.Data != null && Model.Item1.Data.Any() ? Model.Item1.TotalCount.NumberFormat() : "0")</span> bản ghi
                        </h6>
                    </div>
                    <div class="col-auto text-end ps-0 justify-content-end">
                        <div class="d-flex align-items-center" id="table-replace-element">
                            <div class="bulk-select-replace-element d-flex align-items-center">

                                <button class="btn btn-primary no-focus ms-2" type="button"
                                        data-modal="modal-xl"
                                        onclick="return modalGet(this, '@Url.Page(pageName: "Create") ', 'Thêm Job')"
                                        title="Thêm Job">
                                    <i class="fas fa-plus"></i>
                                    <span class="d-none d-sm-inline-block ms-1">Thêm</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </th>
        </tr>
        <tr>
            <th class="align-middle text-center">STT</th>
            <th class="align-middle col-sm-8">Chi tiết</th>
            <th class="align-middle text-nowrap">Thông tin</th>
            <th class="align-middle white-space-nowrap text-end pe-3"></th>
        </tr>
    </thead>
    <tbody class="list" id="table-ticket-body">
        @if (Model.Item1.Data != null && Model.Item1.Data.Any())
        {
            JobGetByPageDto item;
            @for (int i = 0; i < Model.Item1.Data.Count; i++)
            {
                item = Model.Item1.Data[i];

                <tr id="@item.Id" class="align-middle">
                    <td class="align-middle py-3 text-nowrap">
                        @((Model.Item2.Page - 1) * Model.Item2.PageSize + i + 1)
                    </td>
                    <td class="align-middle col-sm-8" style="max-width:800px;">
                        <p class="mb-0 fw-semi-bold fs--1 text-black">@Html.DisplayFor(modelItem => item.JobName)</p>
                        <p class="mt-1 fs--2">@Html.DisplayFor(modelItem => item.JobClassType)</p>
                    </td>
                    <td class="text-nowrap">
                        <div class="d-flex flex-column">
                            <p class="fs--2 mb-0">
                                <i data-bs-toggle="tooltip" title="Tài khoản tạo" class="fas fa-user-plus text-500 fa-sm"></i> @item.CrUserName
                            </p>
                            <p class="fs--2 mb-0">
                                <i data-bs-toggle="tooltip" title="Thời gian tạo" class="fas fa-plus-square text-500 fa-sm"></i> @item.CrDateTime.ToStringFormat()
                            </p>
                        </div>
                    </td>
                    <td class="align-middle white-space-nowrap text-end pe-3">

                        @if (isFullRole)
                        {
                            <button class="btn btn-link p-0 ms-2" type="button"
                                    data-modal="modal-xl"
                                    onclick="return modalGet(this, '@Url.Page(pageName: "Edit", values: new { Id = item.Id })', 'Cập nhật Job')"
                                    data-bs-toggle="tooltip" title="Cập nhật Job">
                                <i class="far fa-edit text-secondary"></i>
                            </button>
                        }
                        @if (isFullRole)
                        {
                            <a href="javascript:void(0)" class="btn btn-link p-0 ms-2"
                               data-ajax="true"
                               data-ajax-url="@Url.Page(pageName: "Index", pageHandler: "Delete", values: new { Id = item.Id })"
                               data-ajax-method="post"
                               data-ajax-begin="setRequestHeader(this, xhr)"
                               data-ajax-success="onSuccessed(this, xhr)"
                               data-ajax-confirm="Xác nhận xóa Job"
                               data-bs-toggle="tooltip" title="Xóa Job">
                                <i class="far fa-trash-alt text-danger"></i>
                            </a>
                        }
                    </td>
                </tr>
            }
        }
        else
        {
            <tr class="align-middle text-warning fs--1 not-found text-center">
                <td colspan="4">Chưa có dữ liệu</td>
            </tr>
        }
    </tbody>
</table>
@await Html.PartialAsync("_PaginationPartial", Model.Item2)