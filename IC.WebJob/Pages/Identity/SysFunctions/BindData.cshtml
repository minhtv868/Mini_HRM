@using IC.Application.Features.IdentityFeatures.SysFunctions.Queries;
@using IC.WebJob.Helpers;
@model Tuple<PaginatedResult<SysFunctionGetPageDto>, PagingInput>
@{
    Layout = null;
}
<table id="sticky-table" class="main-table table table-striped table-hover mb-0">
    <thead class="text-black">
        <tr>
            <th class="pt-1 pb-1" colspan="8">
                <div class="row flex-between-center">
                    <div class="col-auto col-sm-auto d-flex align-items-center pe-0">
                        <h6 class="mb-0 text-nowrap total-rows fw-semi-bold ps-1">Tìm thấy <span class="text-danger">@((Model == null || Model.Item1.TotalCount <= 0) ? "0" : Model.Item1.TotalCount.NumberFormat())</span> bản ghi</h6>
                    </div>
                    <div class="col-auto text-end ps-0 justify-content-end">
                        <div class="d-flex align-items-center" id="table-replace-element">
                            <div class="bulk-select-actions d-none">
                                <form method="post"
                                      data-ajax="true"
                                      data-ajax-url="@Url.Page(pageName: "Index", pageHandler: "BulkActions")"
                                      data-ajax-method="post"
                                      data-ajax-begin="onBegin(this)"
                                      data-ajax-success="onSuccessed(this, xhr, true)">
                                    <div class="d-flex">
                                        <button name="Query.IsShow" value="1" class="btn btn-sm btn-falcon-default rounded-pill m-button-hover-info ms-2" type="submit">
                                            <i class="fas fa-eye"></i>
                                            <span class="d-none d-sm-inline-block ms-1">Hiển thị</span>
                                        </button>
                                        <button name="Query.IsShow" value="2" class="btn btn-sm btn-falcon-default rounded-pill m-button-hover-warning ms-2" type="submit">
                                            <i class="fas fa-eye-slash"></i>
                                            <span class="d-none d-md-inline-block ms-1">Ẩn</span>
                                        </button>
                                        <button name="Query.IsEnable" value="1" class="btn btn-sm btn-falcon-default rounded-pill m-button-hover-info ms-2" type="submit">
                                            <i class="fas fa-toggle-on"></i>
                                            <span class="d-none d-md-inline-block ms-1">Kích hoạt</span>
                                        </button>
                                        <button name="Query.IsEnable" value="2" class="btn btn-sm btn-falcon-default rounded-pill m-button-hover-warning ms-2" type="submit">
                                            <i class="fas fa-toggle-off"></i>
                                            <span class="d-none d-md-inline-block ms-1">Hủy kích hoạt</span>
                                        </button>
                                        <input class="ChkActionIds" type="hidden" name="ChkActionIds" />
                                    </div>
                                </form>
                            </div>
                            <div class="bulk-select-replace-element d-flex align-items-center">
                                <button class="btn btn-primary no-focus ms-2" type="button"
                                        data-modal="modal-lg"
                                        onclick="return modalGet(this, '@Url.Page(pageName: "Create") ', 'Thêm chức năng')"
                                        title="Thêm chức năng">
                                    <i class="fas fa-plus"></i>
                                    <span class="d-none d-sm-inline-block ms-1">Thêm</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </th>
        </tr>
        <tr>
            <th class="fs-0 text-nowrap">
                <div class="form-check mb-0">
                    <input class="form-check-input" type="checkbox" />
                </div>
            </th>
            <th class="align-middle text-nowrap">Tên chức năng</th>
            <th class="align-middle">Đường dẫn</th>
            <th class="align-middle">Vai trò</th>
            <th class="align-middle text-nowrap text-center">Thứ tự</th>
            <th class="align-middle text-nowrap text-center">Hiển thị</th>
            <th class="align-middle text-nowrap">Kích hoạt</th>
            <th class="align-middle white-space-nowrap pe-3"></th>
        </tr>
    </thead>
    <tbody>
        @if (Model.Item1.Data != null && Model.Item1.Data.Any())
        {
            @foreach (var item in Model.Item1.Data)
            {
                <tr id="@item.Id" class="align-middle">
                    <td class="align-middle py-3 text-nowrap">
                        <div class="form-check mb-0">
                            <input class="form-check-input row-checkbox" type="checkbox" name="ChkActionIds" value="@item.Id"  />
                        </div>
                    </td>
                    <td class="text-nowrap">
                        <div class="d-flex align-items-center">
                            <span class="mb-0 fw-semi-bold">
                                @if (!string.IsNullOrWhiteSpace(item.IconPath))
                                {
                                    <i class="@item.IconPath"></i>
                                }
                                @Html.Raw(item.GetNameByLevel())
                            </span>
                        </div>
                    </td>
                    <td class="align-middle">
                        <span class="mb-0" style="word-break: break-all;">@Html.DisplayFor(modelItem => item.Url)</span>
                    </td>
                    <td class="align-middle">
                        @if (item.Roles != null && item.Roles.Any())
                        {
                            foreach (var role in item.Roles)
                            {
                                <small class="badge rounded-pill badge-subtle-primary fs--2 py-0 me-2" style="height:16px !important; line-height:14px !important;"> @role.Name</small>
                            }
                        }
                        <a href="javascript:void(0)"
                           onclick="return modalGet(this, '@Url.Page(pageName: "AssignRoles", values: new { Id = @item.Id })', 'Gán vai trò cho chức năng @item.FunctionName')"
                           title="Gán vai trò cho chức năng @item.FunctionName">
                            <i class="far fa-edit text-600 hover-opacity fa-xs"></i>
                        </a>
                    </td>
                    <td class="align-middle text-nowrap text-center">
                        <a href="javascript:void(0)" class="btn btn-link p-0"
                           data-ajax="true"
                           data-ajax-url="@Url.Page(pageName: "Index", pageHandler: "MoveUp", values: new { Id = @item.Id })"
                           data-ajax-method="post"
                           data-ajax-begin="setRequestHeader(this, xhr)"
                           data-ajax-success="onSuccessed(this, xhr)"
                           title="Di chuyển lên trên">
                            <i class="far fa-arrow-alt-circle-up hover-opacity text-600"></i>
                        </a>
                        <a href="javascript:void(0)" class="btn btn-link p-0 ms-2"
                           data-ajax="true"
                           data-ajax-url="@Url.Page(pageName: "Index", pageHandler: "MoveDown", values: new { Id = @item.Id })"
                           data-ajax-method="post"
                           data-ajax-begin="setRequestHeader(this, xhr)"
                           data-ajax-success="onSuccessed(this, xhr)"
                           title="Di chuyển xuống dưới">
                            <i class="far fa-arrow-alt-circle-down hover-opacity text-600"></i>
                        </a>
                    </td>
                    <td class="align-middle text-nowrap text-center">
                        <div class="form-check form-switch d-flex justify-content-center">
                            <input asp-for="@item.IsShow" class="form-check-input" type="checkbox" disabled />
                        </div>
                    </td>
                    <td class="align-middle text-nowrap text-center">
                        <div class="form-check form-switch d-flex justify-content-center">
                            <input asp-for="@item.IsEnable" class="form-check-input" type="checkbox" disabled />
                        </div>
                    </td>
                    <td class="align-middle white-space-nowrap text-end pe-3">
                        <button class="btn btn-link p-0" type="button"
                                data-modal="modal-lg"
                                onclick="return modalGet(this, '@Url.Page(pageName: "Edit", values: new { Id = item.Id })', 'Cập nhật chức năng @item.FunctionName')" title="Cập nhật chức năng @item.FunctionName">
                            <i class="far fa-edit"></i>
                        </button>
                        <a href="javascript:void(0)" class="btn btn-link p-0 ms-2"
                           data-ajax="true"
                           data-ajax-url="@Url.Page(pageName: "Index", pageHandler: "Delete", values: new { Id = @item.Id })"
                           data-ajax-method="post"
                           data-ajax-begin="setRequestHeader(this, xhr)"
                           data-ajax-success="onSuccessed(this, xhr)"
                           data-ajax-confirm="Xác nhận xóa chức năng @item.FunctionName"
                           title="Xóa chức năng @item.FunctionName">
                            <i class="far fa-trash-alt text-danger"></i>
                        </a>
                    </td>
                </tr>
            }
        }
        else
        {
            <tr class="align-middle text-warning fs--1 not-found text-center">
                <td colspan="8">Chưa có dữ liệu</td>
            </tr>
        }
    </tbody>
</table>
@await Html.PartialAsync("_PaginationPartial", Model.Item2)